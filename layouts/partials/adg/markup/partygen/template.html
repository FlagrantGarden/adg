{{- $data := . -}}
{{- $Pronouns := slice
        "Ey / Em"
        "Fae / Faer"
        "He / Him"
        "He / They"
        "Per / Per"
        "She / Her"
        "She / They"
        "They / Them"
        "They / Her"
        "They / Him"
        "Ve / Ver"
        "Xe / Xem"
        "Zie / Hir"
-}}
{{- $Character := dict
        "name"       "Adventurer"
        "pronouns"   nil
        "brawn"      nil
        "agility"    nil
        "cunning"    nil
        "health"     nil
        "wealth"     nil
        "rituals"    (slice)
        "extra"      nil
        "occupation" nil
        "scar"       nil
-}}
{{- $Characters := slice $Character $Character $Character $Character -}}
{{- $data = merge $data (dict
        "party"           $Characters
        "pronouns"        $Pronouns
        "blank_character" $Character
    )
-}}

{{- $GenerateTooltip := delimit (
slice "Select this option to fully generate a party of four random adventurers."
"Every time you select this option, the page will generate a new random party."
) " " | print | safeJS
-}}
{{- $ResetTooltip := delimit (
        slice "Select this option to clear the generated adventurers."
    ) " " | print | safeJS
-}}

<div x-data="{{ $data | jsonify }}">
    <sl-card class="adg-party-generator">
        <sl-button-group label="Generator Options">
            <sl-tooltip content="{{ $GenerateTooltip }}" hoist>
                <sl-button @click="generateParty($data)" x-ref="menu_generate_party">
                    Generate Adventuring Party
                </sl-button>
            </sl-tooltip>
            <sl-tooltip content="{{ $ResetTooltip }}" hoist>
                <sl-button @click="resetParty($data)" x-ref="menu_reset_party">
                    Reset Adventuring Party
                </sl-button>
            </sl-tooltip>
            <sl-dropdown hoist placement="bottom-end" x-ref="menu_export" :disabled="partyReady($data) == false">
                <sl-button slot="trigger" caret :disabled="partyReady($data) == false">Export Party</sl-button>
                <sl-menu>
                    <sl-menu-item @click="window.print()">
                        To Print / PDF
                    </sl-menu-item>
                    <sl-menu-item @click="exportParty($data)">
                        To Data / JSON
                    </sl-menu-item>
                </sl-menu>
            </sl-dropdown>
        </sl-button-group>
    </sl-card>
    <template x-if="partyReady($data)">
        <div class="adg-party">
            <template x-for="(character, index) in party">
                <sl-card class="adg-party-member">
                    <div slot="header">
                        <sl-input label="Name" x-model.text="character.name"></sl-input>
                        <sl-input label="Pronouns" x-model.text="character.pronouns"></sl-input>
                    </div>

                    <section>
                        <h2>Attributes</h2>
                        <dl>
                            <template x-for="(attribute) in ['agility', 'brawn', 'cunning']">
                                <div class="adg-dl-sxs">
                                    <dt x-text="toTitleCase(attribute)"></dt>
                                    <dd x-text="character[attribute]"></dd>
                                </div>
                            </template>
                        </dl>
                    </section>
                    <section>
                        <h2>Status</h2>
                        <dl>
                            <div class="adg-dl-sxs">
                                <dt>Health</dt>
                                <dd x-text="`${character.health} HP`"></dd>
                            </div>
                            <div class="adg-dl-sxs">
                                <dt>Wealth</dt>
                                <dd x-text="`${character.wealth} SP`"></dd>
                            </div>
                        </dl>
                    </section>

                    <h2>Occupation</h2>
                    <p x-text="character.occupation"></p>

                    <h2>Scar</h2>
                    <p x-text="character.scar"></p>

                    <template x-if="character.rituals.length > 0">
                        <div>
                            <h2>Rituals</h2>
                            <ul>
                                <template x-for="(ritual) in character.rituals">
                                    <dd x-text="ritual"></dd>
                                </template>
                            </ul>
                        </div>
                    </template>

                    <h2>Extra</h2>
                    <p x-text="character.extra"></p>
                </sl-card>
            </template>
        </div>
    </template>
    <template x-if="partyReady($data)">
        <template x-for="(character, index) in party">
            <article class="adg-character-display">
                <h1 x-text="`${character.name} (${character.pronouns})`"></h1>
                <section>
                    <h2>Attributes</h2>
                    <dl>
                        <template x-for="(attribute) in ['agility', 'brawn', 'cunning']">
                            <div class="adg-dl-sxs">
                                <dt x-text="toTitleCase(attribute)"></dt>
                                <dd x-text="character[attribute]"></dd>
                            </div>
                        </template>
                    </dl>
                </section>
                <section>
                    <h2>Status</h2>
                    <dl>
                        <div class="adg-dl-sxs">
                            <dt>Health</dt>
                            <dd x-text="`${character.health} HP`"></dd>
                        </div>
                        <div class="adg-dl-sxs">
                            <dt>Wealth</dt>
                            <dd x-text="`${character.wealth} SP`"></dd>
                        </div>
                    </dl>
                </section>

                <h2>Occupation</h2>
                <p x-text="character.occupation"></p>

                <h2>Scar</h2>
                <p x-text="character.scar"></p>

                <template x-if="character.rituals.length > 0">
                    <div>
                        <h2>Rituals</h2>
                        <ul>
                            <template x-for="(ritual) in character.rituals">
                                <dd x-text="ritual"></dd>
                            </template>
                        </ul>
                    </div>
                </template>

                <h2>Extra</h2>
                <p x-text="character.extra"></p>
            </article>
        </template>
    </template>
</div>